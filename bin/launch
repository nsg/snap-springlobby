#!/bin/bash

echo "The game data will be downloaded/stored in $SNAP_USER_COMMON"
export HOME=$SNAP_USER_COMMON

mkdir -p $SNAP_USER_COMMON/.spring
mkdir -p $SNAP_USER_COMMON/.springlobby

ln -sf $SNAP_USER_COMMON/.spring $SNAP_USER_COMMON/spring
ln -sf $SNAP_USER_COMMON/.springlobby $SNAP_USER_COMMON/springlobby

# I'm not sure why, but for some reason the lobby fails to detect
# these things when we download the engine. A restart solves it
# but that's annoying so these lines are here to solve that.
test -s $SNAP_USER_COMMON/.springlobby/springlobby.conf || \
cat > $SNAP_USER_COMMON/.springlobby/springlobby.conf <<EOF
[Spring]
DownloadDir=$SNAP_USER_COMMON/.spring
CurrentIndex=103.0
[Spring/Paths]
[Spring/Paths/103.0]
SpringBinPath=$SNAP_USER_COMMON/.spring/engine/103.0/spring
UnitSyncPath=$SNAP_USER_COMMON/.spring/engine/103.0/libunitsync.so
SpringBundlePath=$SNAP_USER_COMMON/.spring/engine/103.0
[General]
firstrun=1
EOF

exec desktop-launch $SNAP/bin/springlobby
